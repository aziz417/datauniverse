"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){window.Site={editDataset:function(t,e){t.preventDefault(),$("#datasource-modal").remove(),this.dataid=$(e).closest("div.parent").attr("data-id"),this.table=$(e).closest(".block").find("table"),this.desc=this.table.find("tr.description").find("td").text(),this.title=this.table.find("tr.datasetname").find("td").text(),this.price=this.table.find("tr.datasetprice").find("td > span").text(),this.subscriptionfee=this.table.find("tr.subscriptionfee").find("td > span").text(),$("body").append(this.modalLayout(this.title,this.modalContent())),$("#datasource-modal").modal({keyboard:!1,backdrop:!1})},modalLayout:function(t,e){var n='<div id="datasource-modal" class="modal fade" style="margin-top:5%">';return n+='<div class="modal-dialog">',n+='<div style="width:100%" class="modal-content">',n+='<div class="modal-header">',n+='<h4 class="modal-title">'+t+"</h4>",n+="</div>",n+='<div class="modal-body">',n+=e,n+="</div>",n+='<div class="modal-footer" style="text-align: right">',n+='<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>',n+='<button onclick="Site.postEdit(event,this)" type="button" class="btn btn-primary">Save changes</button>',n+="</div>",n+="</div>",n+="</div>",n+="</div>"},modalContent:function(){var t=this,e='<form enctype="multipart/form-data">';return e+='<div class="form-group">',e+='<label for="image">Image</label>',e+='<input type="file" class="form-control" name="image" id="image" placeholder="Image">',e+='<div class="help-block">Recommended size is 1500px x 750px</div>',e+="</div>",e+='<div class="form-group">',e+='<label for="title">Title</label>',e+='<input type="text" class="form-control" id="title" placeholder="Title" value="'+t.title+'">',e+="</div>",e+='<div class="form-group">',e+='<label for="description">Description</label>',e+='<textarea style="min-height: 150px" class="form-control" id="description" placeholder="Price">'+t.desc+"</textarea>",e+="</div>",e+='<div class="form-group">',e+='<label for="price">Price</label>',e+='<input type="text" class="form-control" id="price" placeholder="Price" value="'+t.price+'">',e+="</div>",e+='<div class="form-group">',e+='<label for="price">Subscription Fee</label>',e+='<input type="text" class="form-control" id="subscriptionfee" placeholder="Price" value="'+t.subscriptionfee+'">',e+="</div>",e+="</form>"},postEdit:function(t,e){t.preventDefault();var n=this;this.title=$("#title").val(),this.desc=$("#description").val(),this.price=$("#price").val(),this.subscription=$("#subscriptionfee").val(),this.item_of_interest=$("#item_of_interest").val();var o={},i={title:this.title,description:this.desc,price:this.price,subscription:this.subscription,item_of_interest:this.item_of_interest,id:n.dataid};o.data=i,$.trim($("#image").val())?core.xhrCall("#image","datasets/edit",o,this.editSuccess):core.ajaxCall("POST","datasets/edit",i,"json",this.editSuccess)},editSuccess:function(t){if(t.success)window.location.reload();else{var e="";$.each(t.message,function(t,n){e+=" - "+n+"\n"}),alert(e)}},loader:function(t,e){var n="";return n+='<div class="loader-background" style="'+e+'">',n+="<div>",n+='<img src="/images/bx_loader.gif">',n+="</div>",n+="</div>"}},$("select#featured-sort, select#featured-subcategory").on("change",function(){var t=URI.parse(window.location.toString());window.location=t.path+"?sort="+$("select#featured-sort").val()+"&subcategory="+($("select#featured-subcategory").val()?$("select#featured-subcategory").val():"")}),$("label[for='signupform-agree']").append('<span style="color: red">*</span> I agree to ').append($("<a/>",{href:"/terms-conditions",class:"terms",target:"_blank"}).html("Terms and Conditions")),$("label[for='signupform-agreeseller']").append('<span style="color: red">*</span> I agree to ').append($("<a/>",{href:"/approval-policy",class:"terms",target:"_blank"}).html("Seller Terms and Conditions"));var t=$('#form-signup input[type="checkbox"][name="SignupForm[userType]"]'),e=function(){t.prop("checked")?$("div.field-signupform-agreeseller").show():$("div.field-signupform-agreeseller").hide()};if(e(),t.change(function(){e()}),"signup"===window.login_type&&(window.location.hash="#signup"),$("#signupform-verifycode").change(function(){var t=$(this).val();console.log("code: "+t),null!=t&&""!==t&&$('form#form-signup button[name="signup-button"]').prop("disabled",!1)}),$(".banner .item").click(function(t){$(t.currentTarget).data("link")&&(window.location=$(t.currentTarget).data("link"))}),window.DataAndSons.signup_success){var n="Thank you, you are all signed up with Data & Sons. An email is sent to your email address with instructions to verify your email account.";window.DataAndSons.signup_is_seller&&(n+='<br/><a href="/account#tab-2" style=" text-decoration: underline;">Click here to setup your bank details.</a>'),bootbox.dialog({message:n,title:"Registration Successful",buttons:{default:{label:"OK",className:"btn-default"}}})}$("#form-signup").on("ajaxBeforeSend",function(t,e,n){console.log("loading"),$("#btn-signup").button("loading")}).on("ajaxComplete",function(t,e,n){$("#btn-signup").button("reset"),console.log(is_recaptcha_success),is_recaptcha_success||$("#btn-signup").prop("disabled",!0),console.log("done loading")}),window.DataAndSons.success_message&&$("#modal-success").modal("show")}();var is_recaptcha_success=!1,recaptchaSuccess=function(t){$('form#form-signup button[name="signup-button"]').prop("disabled",!1),is_recaptcha_success=!0},recaptchaExpired=function(){$('form#form-signup button[name="signup-button"]').prop("disabled",!0),is_recaptcha_success=!1},showErrorMessage=function(t){null==t&&(t="Something happened unexpectedly"),toastr.error(t,"Oops!")},getBlockuiSettings=function(t){return t||(t="Loading..."),{message:"<i class='fa fa-spinner fa-spin'></i> "+t,css:{background:"none",border:"none",color:"white"}}};window.DataAndSons.forms={},window.Form=function(t){var e=this;$.extend(this,t),this.errors=new FormErrors,this.busy=!1,this.successful=!1,this.getFormData=function(){var t=new FormData;for(var e in this)if(this.hasOwnProperty(e)&&"function"!=typeof this[e]){var n=this[e];if(null==n)continue;if(n instanceof Array)for(var o=n,i=0;i<o.length;i++)t.append(e+"[]",o[i]);else t.append(e,this[e])}return t},this.startProcessing=function(){e.errors.forget(),e.busy=!0,e.successful=!1},this.finishProcessing=function(){e.busy=!1,e.successful=!0},this.resetStatus=function(){e.errors.forget(),e.busy=!1,e.successful=!1},this.setErrors=function(t){e.busy=!1,e.errors.set(t)},this.feedback=function(t){return{"has-danger":e.errors.has(t)}},this.helpBlock=function(t){if(e.errors.has(t))return'<div class="invalid-feedback">'+this.errors.get(t)+"</div>"},this.inputFeedback=function(t){return{"is-invalid":e.errors.has(t)}}},window.FormErrors=function(){this.errors={},this.hasErrors=function(){return!_.isEmpty(this.errors)},this.has=function(t){return _.indexOf(_.keys(this.errors),t)>-1},this.all=function(){return this.errors},this.flatten=function(){return _.flatten(_.toArray(this.errors))},this.get=function(t){if(this.has(t))return this.errors[t][0]},this.set=function(t){"object"===(void 0===t?"undefined":_typeof(t))?this.errors=t:this.errors={form:["Something went wrong. Please try again or contact customer support."]}},this.forget=function(){this.errors={}},this.add=function(t,e){Vue.set(this.errors,t,[e])}},window.DataAndSons.Utils={getS3Url:function(t){return window.DataAndSons.env.S3_URL+"/"+t}},$.extend(DataAndSons,{post:function(t,e){return DataAndSons.sendForm("post",t,e)},postData:function(t,e){return DataAndSons.sendFormData("post",t,e)},put:function(t,e){return DataAndSons.sendForm("put",t,e)},putData:function(t,e){return DataAndSons.sendFormData("put",t,e)},delete:function(t,e){return DataAndSons.sendForm("delete",t,e)},sendFormData:function(t,e,n){return new Promise(function(o,i){n.startProcessing(),Vue.http.options.emulateJSON=!0,Vue.http[t](e,n.getFormData()).then(function(t){n.finishProcessing(),o(t.data)}).catch(function(t){500===t.status&&window.toastr.error("Something happened unexpectedly. Please contact support."),n.errors.set(t.data),n.busy=!1,i(t.data)}).finally(function(){Vue.http.options.emulateJSON=!1})})},sendForm:function(t,e,n){return new Promise(function(o,i){n.startProcessing(),Vue.http[t](e,JSON.parse(JSON.stringify(n))).then(function(t){n.finishProcessing(),o(t.data)}).catch(function(t){500===t.status&&window.toastr.error("Something happened unexpectedly. Please contact support."),n.errors.set(t.data),n.busy=!1,i(t.data)})})}}),Vue.filter("date",function(t){return moment.unix(t).local().format("MMMM Do, YYYY")}),Vue.filter("datetime",function(t){return moment.unix(t).local().format("MMMM Do, YYYY h:mm A")}),Vue.filter("from_now",function(t){return moment.unix(t).local().fromNow(!0)}),Vue.filter("relative",function(t){return moment.locale("en",{relativeTime:{future:"in %s",past:"%s",s:"1s",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:"%dd",M:"1 month ago",MM:"%d months ago",y:"1y",yy:"%dy"}}),moment.unix(t).local().fromNow()}),Vue.filter("in_array",function(t,e){return e.indexOf(t)>-1}),Vue.filter("truncate",function(t,e){return t}),Vue.filter("stripTags",function(t){var e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}),Vue.http.interceptors.push(function(t,e){t.headers.append("X-CSRF-TOKEN",window.DataAndSons._csrf),t.headers.append("YII_CSRF_TOKEN",window.DataAndSons._csrf),e()}),Vue.mixin({methods:{isEmpty:function(t){return null==t||""===t},getFileImageData:function(t,e){if(t.files&&t.files[0]){var n=$(t).val().split(".").pop().toLowerCase();if(-1===$.inArray(n,["gif","png","jpg","jpeg"]))alert("Invalid file."),$(t).val(null),e(null);else{var o=new FileReader;o.onload=function(t){e(t.target.result)},o.readAsDataURL(t.files[0])}}else e(null)},stripTags:function(t){var e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""},getUrlParameter:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),n=e.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}}}),toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};